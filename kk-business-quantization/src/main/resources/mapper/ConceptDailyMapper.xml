<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kk.business.quantization.dao.mapper.ConceptDailyMapper">

    <select id="selectLeaderListByRange">
        select  sb.name,dg.*,sd.close 'sd_close',ed.close 'ed_close'
        , round((ed.close - sd.close) / sd.close * 100 ,2)'se_pct'
        , round((ed.close - dg.high) / dg.high * 100 ,2)'roll_back_pct'
        , round((dg.high - sd.close) / sd.close * 100,2) 'max_pct'
        from (
        select concept_id 'ts_code', max(high) 'high', MIN(low) 'low'  from concept_daily
        where trade_date <![CDATA[>=]]> #{startDate} and trade_date <![CDATA[<=]]> #{endDate} group by concept_id
        ) dg
        left join
        concept_daily sd on sd.trade_date = #{startDate} and dg.ts_code = sd.concept_id
        left join
        concept_daily  ed on ed.trade_date = #{endDate} and dg.ts_code = ed.concept_id
        left join
        concept sb on sb.code = dg.ts_code
        order by (ed.close - sd.close)/sd.close desc
        limit #{pageSize}
    </select>

</mapper>
